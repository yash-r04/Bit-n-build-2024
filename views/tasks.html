<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
</head>
<body>
    <h1>Your Tasks</h1>
    
    <div id="taskForm">
        <input type="text" id="taskName" placeholder="Task Name" required />
        <input type="text" id="viewLink" placeholder="Google Drive Link (optional)" />
        <button id="addTaskBtn">Add Task</button>
    </div>

    <h2>Todo List</h2>
    <ul id="taskList"></ul>

    <script>
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');

        // Fetch all tasks when the page loads
        window.onload = async function() {
            const response = await fetch('/tasks');
            const tasks = await response.json();
            tasks.forEach(task => addTaskToDOM(task));
        };

        // Add a task
        addTaskBtn.addEventListener('click', async () => {
            const taskName = document.getElementById('taskName').value;
            const viewLink = document.getElementById('viewLink').value;

            const response = await fetch('/task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ taskName, viewLink })
            });

            const task = await response.json();
            addTaskToDOM(task);
        });

        // Add task to DOM
        function addTaskToDOM(task) {
    const taskItem = document.createElement('li');
    taskItem.id = task._id;  // Set the id of the <li> to the task's unique ID

    taskItem.innerHTML = `
        ${task.taskName} - Added on: ${new Date(task.createdAt).toLocaleDateString()}
        <a href="${task.viewLink}" target="_blank">View</a>
        <button onclick="deleteTask('${task._id}')">Done</button>
    `;
    taskList.appendChild(taskItem);
}


        // Delete task
        async function deleteTask(taskId) {
    await fetch(`/task/${taskId}`, { method: 'DELETE' });

    // Find the task <li> by its id and remove it from the DOM
    const taskElement = document.getElementById(taskId);
    if (taskElement) {
        taskElement.remove();
    }
}

    </script>
</body>
</html>
